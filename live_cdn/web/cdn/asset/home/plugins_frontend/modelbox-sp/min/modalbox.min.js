!function(t,e,i){"use strict";var a,o,s,l,n=0,r=function(e){this.$el=t(e),this.settings={},this.init()};r.defaults={auto:!1,skin:null,url:null,rel:null,width:null,height:null,maxwidth:700,maxheight:500,opacity:.4,overlay:!0,draggable:!0,header:!0,footer:!1,title:"",html:"",top:!1,left:!1,multiple:!0,onbefore:function(){},onafter:function(){}},r.prototype={scaleImage:function(){var t=this,e=l.find("img");e.length&&e.css("display","none").one("load.flexify.modalbox",function(){e.css("display","block").imagescale({width:t.settings.maxwidth,height:t.settings.maxheight}),t.position()})},init:function(){var i=this;""!=this.settings.skin&&o.addClass(this.settings.skin),t(e).on("resize.flexify.modalbox",function(){i.position()})},makeSettings:function(e){e=e||{},e.skin=e.skin||this.$el.attr("modal-skin"),e.url=e.url||this.$el.attr("href"),e.title=e.title||this.$el.attr("title"),e.rel=e.rel||this.$el.attr("rel"),e.width=e.width||this.$el.attr("modal-width"),e.height=e.height||this.$el.attr("modal-height"),e.html=e.html||this.$el.attr("modal-html"),e.maxwidth=e.maxwidth||this.$el.attr("modal-maxwidth"),e.maxheight=e.maxwidth||this.$el.attr("modal-maxheight"),this.settings=t.extend({},r.defaults,e)},open:function(){var e,n=this,r=n.settings,d=r.url;switch(1==r.overlay&&a.not(":visible")&&n.overlay("show"),o.addClass("modalbox-active").show(),"form"==r.rel&&(r.top="35px"),"confirm"!=r.rel&&"alert"!=r.rel&&(""!=r.title&&s.prepend('<div class="modal-header"><div class="modal-title">'+r.title+"</div></div>"),s.find(".modal-close").show(),l.html('<div class="modal-loading"></div>'),n.position()),r.rel){case"html":l.html(r.html),n.scaleImage();break;case"image":l.html('<img src="'+d+'" />'),n.scaleImage();break;case"imagepicker":e=t.ajax({url:d,type:"GET",data:r.params,async:!1}).responseText,l.html(e);break;case"iframe":e='<iframe id="modal_iframe" src="'+d+'" width="100%" height="100%" frameBorder="0"></iframe>',l.html(e).css("overflow-y","hidden"),t("#modal_iframe").one("load.flexify.modalbox",function(){var e=t(this),i=e.contents().find("title").text();"undefined"!=typeof i&&""!=i&&(s.prepend('<div class="modal-header"><div class="modal-title">'+i+"</div></div>"),n.position(),o.draggable({handle:".modal-header",containment:"document",stop:function(e,i){t(this).css({top:i.position.top,left:i.position.left})}}))});break;case"ajax":e=t.ajax({url:d,type:"GET",data:r.params,async:!1}).responseText,r.onbefore(),l.html(e),n.scaleImage(),r.onafter(),n.formcontrol();break;case"form":if(e=r.html,""==e){var c=r.params,h="undefined"!=typeof r.request_method?r.request_method:"GET";e=t.ajax({url:d,type:h,data:c,async:!1}).responseText}r.onbefore(),l.html(e).tabindex(),r.onafter(),n.formcontrol();break;case"confirm":s.find(".modal-close").hide(),l.html('						<form><table class="table">							<tr><td class="text-center" style="padding:30px;">'+r.html+'</td></tr>							<tr><td class="foot text-center">								<button class="btn btn-danger" name="yes">Yes</button>								<button class="btn btn-primary" name="no" data-dismiss="modal">No</button>							</td></tr>						</table></form>					').on("click.flexify.modalbox",'button[name="yes"]',function(){return t.ajax({type:"GET",url:d}).done(function(t){return n.formresult(t,d)}),!1});break;case"alert":s.find(".modal-close").hide(),l.html('						<form><table class="table">							<tr><td class="text-center" style="padding:30px;">'+r.html+'</td></tr>							<tr><td class="foot text-center">								<button class="btn btn-primary" name="yes">OK</button>							</td></tr>						</table></form>					').on("click.flexify.modalbox",'button[name="yes"]',function(){return n.close(),!1})}n.position(),o.on("click.flexify.modalbox",'[data-dismiss="modal"]',t.proxy(this.close,this)),t(i).on("keydown.flexify.modalbox",t.proxy(this.keydown,this))},close:function(){n>1?(a.remove(),o.remove(),n--,r.getObject()):(this.overlay("hide"),o.removeClass("modalbox-active").removeAttr("style").hide(0,function(){s.find(".modal-header").remove(),s.find(".modal-error").remove(),l.removeAttr("style").html('<div class="modal-loading"></div>')})),t(i).off("keydown.flexify.modalbox")},overlay:function(e){return(this.settings.overlay!==!1||null!==this.settings.opacity)&&("show"==e?(a.css({opacity:+this.settings.opacity,visibility:"visible","z-index":99999+n}).fadeIn(50),a.off("click")):a.fadeOut(50,function(){t(this).removeAttr("style")})),!1},position:function(){var i=this,a=i.settings,s=t(e);a.width?l.width(a.width):l.width()>a.maxwidth&&l.width(a.maxwidth),a.height?l.height(a.height):l.height()>a.maxheight&&l.height(a.maxheight);var r=0,d=0,c=o.offset(),h=s.scrollTop(),m=s.scrollLeft();o.css({top:-9e4,left:-9e4}),c.top-=h,c.left-=m,o.css({position:"fixed","z-index":1e5+n}),d+=a.left!==!1?a.left:Math.round(Math.max(s.width()-o.width(),0)/2),r+=a.top!==!1?a.top:Math.round(Math.max(s.height()-o.height(),0)/2),o.css({top:r,left:d,visibility:"visible"})},formresult:function(e,i){var a=this,o=t.parseJSON(e);switch(""!=o.msg&&(o.msg=t("<p>"+o.msg+"</p>").text()),""!=o.reloadurl&&(o.reloadurl="this"==o.reloadurl?i:o.reloadurl.replace(/&amp;/g,"&")),o.type){case"error":if(t(".modalbox-error").hasClass("active"))return!1;var n=t('<div class="modalbox-error">'+o.msg+'<span class="close">&times;</span></div>');n.addClass("active").prependTo(s).stop(!0,!0).slideDown(100,function(){n.on("click.flexify.modalbox","span.close",function(){return n.removeClass("active").stop().slideUp(100),!1})}).on("click.flexify.modalbox",function(){return n.removeClass("active").stop().slideUp(100),!1}).delay(1e4).slideUp(100,function(){n.removeClass("active")});break;case"success":if("window"==o.reloadtarget)a.close(),""!=o.reloadurl&&(location.href=o.reloadurl);else if("parent"==o.reloadtarget){a.close();var r=t.ajax({url:o.reloadurl,type:"GET",async:!1}).responseText;a.settings.onbefore(),l.html(r).tabindex(),a.settings.onafter()}else{if(t(".modalbox-success").hasClass("active"))return!1;if(""!=o.msg){var n=t('<div class="modalbox-success">'+o.msg+'<span class="close"></span></div>');n.addClass("active").prependTo(s).stop(!0,!0).slideDown(100,function(){n.on("click.flexify.modalbox","span.close",function(){return n.removeClass("active").stop().slideUp(100),!1})}).on("click.flexify.modalbox",function(){return n.removeClass("active").stop().slideUp(100),!1}).delay(5e3).slideUp(100,function(){n.removeClass("active")})}if(""!=o.reloadurl){var r=t.ajax({url:o.reloadurl,type:"GET",async:!1}).responseText;a.settings.onbefore(),"this"==o.reloadtarget?l.html(r).tabindex():l.find(o.reloadtarget).html(r).tabindex(),a.settings.onafter(),a.formcontrol(),a.position()}}break;case"notice":a.close(),t("div.container").notify({msg:o.msg,css:"notify-notice"})}return!1},formcontrol:function(){var e=this,a=l.find("form"),o=a.attr("enctype")||null,s=a.attr("action")||e.settings.url,n=s;"multipart/form-data"==o&&(s+=-1==n.indexOf("?")?"/?ajax=1":"&ajax=1"),a.attr("action",s).prepend(t('<input type="hidden" name="do" value="save"/>')),a.on("click.flexify.modalbox",'button[type="submit"]',function(){if(t(".modalbox-error, .modalbox-success").hasClass("active"))return!1;var l=t(this).attr("disabled",!0);if("multipart/form-data"==o){var r=t('<iframe id="uploadstatus" name="uploadstatus" style="position:absolute;top:-9999px;left:-9999px;" src="about:blank" />');t(i.body).append(r),a.attr("target","uploadstatus"),r.on("load",function(){var t=r.contents().find("body").html();return setTimeout(function(){r.remove()},100),l.attr("disabled",!1),e.formresult(t,n)}),a.submit()}else t.ajax({type:"POST",url:s,data:a.serialize()}).done(function(t){return l.attr("disabled",!1),e.formresult(t,n)});return!1}).on("click.flexify.modalbox",'button[name="cancel"]',function(){return t(".modalbox-error, .modalbox-success").remove(),e.close(),!1})},keydown:function(t){switch(t.keyCode){case 27:this.close();break;case 13:"TEXTAREA"!=t.target.tagName&&"INPUT"!=t.target.tagName&&t.preventDefault()}}},r.setup=function(){n++,t(i.body).append('			<div id="modalbox_overlay_'+n+'" class="modalbox-overlay"></div>			<div id="modalbox_'+n+'" class="modalbox" style="z-index:'+(100+n)+'">				<div class="modal-container">					<a class="modal-close" href="javascript://" data-dismiss="modal">&times;</a>					<div class="modal-content"></div>				</div>			</div>		'),r.getObject()},r.getObject=function(){a=t("#modalbox_overlay_"+n),o=t("#modalbox_"+n),s=o.find("div.modal-container"),l=o.find("div.modal-content")},t(r.setup),t.fn.modalbox=t.modalbox=function(e){var i=this;return"object"==typeof e&&o.hasClass("modalbox-active")&&r.setup(),i[0]||(i=t("<a/>")),i.each(function(){var i=t(this).data("flexify.modalbox");i||t(this).data("flexify.modalbox",i=new r(this)),i.makeSettings(e),i["string"==typeof e?e:"open"]()}),i}}(jQuery,window,document),function(t){"use strict";t.fn.tabindex=function(){return this.find("input, select, textarea, button, iframe").each(function(t){"hidden"!=this.type&&(this.tabIndex=1+t++)})}}(jQuery),function(t){"use strict";t.fn.imagescale=function(e){var i=0;return e.height||e.width?(e.height&&e.width&&(i=e.width/e.height),this.one("load",function(){this.removeAttribute("height"),this.removeAttribute("width"),this.style.height=this.style.width="";var t=this.height,a=this.width,o=a/t,s=e.height,l=e.width,n=i;n||(n=s?o+1:o-1),(s&&t>s||l&&a>l)&&(o>n?s=~~(t/a*l):l=~~(a/t*s),this.height=s,this.width=l)}).each(function(){this.complete&&t(this).trigger("load"),this.src=this.src})):this}}(jQuery);